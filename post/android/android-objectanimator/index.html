<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css">
  <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script>

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.liushulun.cn","root":"/","images":"/images","scheme":"Gemini","version":"8.3.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#EB6D39","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeInDown","post_header":null,"post_body":null,"coll_header":"none","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="（1）ValueAnimator 基本介绍；（2）ObjectAnimator 基本介绍；（3）ObjectAnimator 与 Matrix 配合实现动画效果；（4）动画并行、监听。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android-ObjectAnimator">
<meta property="og:url" content="https://www.liushulun.cn/post/android/android-objectanimator/index.html">
<meta property="og:site_name" content="Luis&#39;s Blogs">
<meta property="og:description" content="（1）ValueAnimator 基本介绍；（2）ObjectAnimator 基本介绍；（3）ObjectAnimator 与 Matrix 配合实现动画效果；（4）动画并行、监听。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.liushulun.cn/post/android/android-objectanimator/image_initial.png">
<meta property="og:image" content="https://www.liushulun.cn/post/android/android-objectanimator/click_change_alpha.gif">
<meta property="og:image" content="https://www.liushulun.cn/post/android/android-objectanimator/code_of_setpropertyname.png">
<meta property="og:image" content="https://www.liushulun.cn/post/android/android-objectanimator/click_scale_up.gif">
<meta property="og:image" content="https://www.liushulun.cn/post/android/android-objectanimator/android-objectanimator-data/scale_up_and_down.gif">
<meta property="og:image" content="https://www.liushulun.cn/post/android/android-objectanimator/scale_up_and_alpha.gif">
<meta property="og:image" content="https://www.liushulun.cn/post/android/android-objectanimator/animator_continually.gif">
<meta property="og:image" content="https://www.liushulun.cn/post/android/android-objectanimator/init_click_event.gif">
<meta property="og:image" content="https://www.liushulun.cn/post/android/android-objectanimator/multi_animator_issue.gif">
<meta property="og:image" content="https://www.liushulun.cn/post/android/android-objectanimator/fixed_multi_animator.gif">
<meta property="article:published_time" content="2019-02-26T10:25:58.000Z">
<meta property="article:author" content="Luis">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Matrix">
<meta property="article:tag" content="动画">
<meta property="article:tag" content="ObjectAnimator">
<meta property="article:tag" content="属性动画">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.liushulun.cn/post/android/android-objectanimator/image_initial.png">


<link rel="canonical" href="https://www.liushulun.cn/post/android/android-objectanimator/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

<title>Android-ObjectAnimator | Luis's Blogs</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle Navigation" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Luis's Blogs</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">V 1.1.6</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">62</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">11</span></a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">86</span></a></li>
        
            
  <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-comments fa-fw"></i>About</a></li>


      
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>


</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Catalogue
        </li>
        <li class="sidebar-nav-overview">
          SiteInfo
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Android-ObjectAnimator"><span class="nav-text">Android-ObjectAnimator</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%9E%84%E6%80%9D"><span class="nav-text">1. 构思</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-ValueAnimator%E4%B8%8EObjectAnimator"><span class="nav-text">2. ValueAnimator与ObjectAnimator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-ValueAnimator%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="nav-text">2.1 ValueAnimator的基本介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-ObjectAnimator%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="nav-text">2.2 ObjectAnimator的基本介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-ObjectAnimator%E9%85%8D%E5%90%88Matrix"><span class="nav-text">3. ObjectAnimator配合Matrix</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-ObjectAnimator%E5%A4%9A%E5%8A%A8%E7%94%BB%E5%B9%B6%E8%A1%8C"><span class="nav-text">4. ObjectAnimator多动画并行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-PropertyValuesHolder%E5%B1%9E%E6%80%A7%E5%80%BC%E4%BF%9D%E5%AD%98%E5%99%A8"><span class="nav-text">4.1 PropertyValuesHolder属性值保存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-AnimatorSet%E5%8A%A8%E7%94%BB%E9%9B%86%E5%90%88"><span class="nav-text">4.2 AnimatorSet动画集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-AnimatorListener%E5%8A%A8%E7%94%BB%E7%9B%91%E5%90%AC"><span class="nav-text">4.3 AnimatorListener动画监听</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-AnimatorListener%E7%9A%84%E8%BF%AD%E4%BB%A3"><span class="nav-text">4.3.1 AnimatorListener的迭代</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E9%99%84%E5%BD%95-%E5%8F%82%E8%80%83%E6%8C%87%E5%AF%BC"><span class="nav-text">5. 附录[参考指导]</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Luis"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Luis</p>
  <div class="site-description" itemprop="description">Keep Learning</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">Posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">Categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">86</span>
        <span class="site-state-item-name">Tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/liushulun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;liushulun" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:luis96@foxmail.com" title="E-Mail → mailto:luis96@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/about/" title="Chats → &#x2F;about&#x2F;"><i class="fa fa-comments fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/" title="Home → &#x2F;"><i class="fa fa-home fa-fw"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-users fa-fw"></i>
      友链
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://renxingkai.github.io/" title="https:&#x2F;&#x2F;renxingkai.github.io" rel="noopener" target="_blank">CinKate</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.juanertu.com/" title="https:&#x2F;&#x2F;blog.juanertu.com" rel="noopener" target="_blank">ConstOwn</a>
        </li>
    </ul>
  </div>


        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/liushulun" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.liushulun.cn/post/android/android-objectanimator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Luis">
      <meta itemprop="description" content="Keep Learning">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luis's Blogs">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android-ObjectAnimator
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted:</span>

      <time title="Created::2019-02-26 18:25:58" itemprop="dateCreated datePublished" datetime="2019-02-26T18:25:58+08:00">2019-02-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">Categories:</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  






<!-- 注释开始 #############################################

  <script>
    function post_nav(post) {
      const theme = hexo.theme.config;
      if (theme.post_navigation === false || (!post.prev && !post.next)) return '';
      const prev = theme.post_navigation === 'right' ? post.prev : post.next;
      const next = theme.post_navigation === 'right' ? post.next : post.prev;
      const left = prev ? `
        <a href="${this.url_for(prev.path)}" rel="prev" title="${prev.title}">
          <i class="fa fa-chevron-left"></i> ${prev.title}
        </a>` : '';
      const right = next ? `
        <a href="${this.url_for(next.path)}" rel="next" title="${next.title}">
          ${next.title} <i class="fa fa-chevron-right"></i>
        </a>` : '';
      return `
        <div class="post-nav">
          <div class="post-nav-item">${left}</div>
          <div class="post-nav-item">${right}</div>
        </div>`;
    }
  </script>
  
  <div style="position: absolute; top: -20px;">post_nav(post)</div>

############################################# 注释结束 -->



<!-- 注释开始 #############################################
  
  <div style="position: fixed; width: 100%;">
    
      
      <div class="post-tags">
          <a href="/tags/Android/" rel="tag"><i class="fa fa-tag"></i> Android</a>
          <a href="/tags/Matrix/" rel="tag"><i class="fa fa-tag"></i> Matrix</a>
          <a href="/tags/%E5%8A%A8%E7%94%BB/" rel="tag"><i class="fa fa-tag"></i> 动画</a>
          <a href="/tags/ObjectAnimator/" rel="tag"><i class="fa fa-tag"></i> ObjectAnimator</a>
          <a href="/tags/%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB/" rel="tag"><i class="fa fa-tag"></i> 属性动画</a>
      </div>
  </div>
############################################# 注释结束 -->

    <span class="post-meta-item" title="Post Symbols">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Post Symbols:</span>
      <span>17k</span>
    </span>
    <span class="post-meta-item" title="Read Time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Read Time &asymp;</span>
      <span>18 Min</span>
    </span>
</div>

            <div class="post-description">（1）ValueAnimator 基本介绍；（2）ObjectAnimator 基本介绍；（3）ObjectAnimator 与 Matrix 配合实现动画效果；（4）动画并行、监听。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <span id="more"></span>

<h1 id="Android-ObjectAnimator"><a href="#Android-ObjectAnimator" class="headerlink" title="Android-ObjectAnimator"></a>Android-ObjectAnimator</h1><p>前言：之前的项目有一个功能需要对“画布”进行动画变换而不改变 View 本身，在上一篇 <a href="/post/Android/android-matrix-basic/android-matrix-basic/" title="@LINK">Android属性——Matrix矩阵</a> 中，已经用 Matrix 实现了对画布的变换，但只能实现跳跃式变换，还需要加上平缓的动画过渡效果，因此搭配使用 ObjectAnimator 实现功能并记录于本文。</p>
<hr>
<h2 id="1-构思"><a href="#1-构思" class="headerlink" title="1. 构思"></a>1. 构思</h2><p>在项目中，有一个功能是希望能在介绍页对 App 的功能做一些引导指示，一开始构思这个效果的时候，最简单的也是最容易想到的方式就是预设固定的图片，在需要时设置显示，不需要提示时隐藏：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要提示时</span></span><br><span class="line">imageView.setVisibility(View.VISIBLE);</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 不需要提示时</span></span><br><span class="line">imageView.setVisibility(View.INVISIBLE);</span><br></pre></td></tr></table></figure>

<p>但是这种方式太过简单和死板界面也相当不优雅，并且也只能完成一些非常非常简单的视图展示效果，在需要动态展示一些过程的时候就很难实现预期效果了。于是想到了 <strong>ValueAnimator</strong> ——数值属性动画这个神奇的东西，ValueAnimator 是一个非常强大的类。但是为什么最后还是没有用 ValueAnimator 呢？接下来本篇就会对 ValueAnimator 做一个简单的介绍，并解释其与 ObjectAnimator 的联系和异同。</p>
<hr>
<h2 id="2-ValueAnimator与ObjectAnimator"><a href="#2-ValueAnimator与ObjectAnimator" class="headerlink" title="2. ValueAnimator与ObjectAnimator"></a>2. ValueAnimator与ObjectAnimator</h2><p>提到这两个东西，就必须首先说明：<strong>ValueAnimator</strong> 是 <strong>ObjectAnimator</strong> 它爹（ObjectAnimator：？？？），ObjectAnimator 是继承自 ValueAnimator 的，因此 ObjectAnimator 具有 ValueAnimator 的全部特性，并重写了 ValueAnimator 中的部分方法，定性地总结一句，ObjectAnimator 具有更高的灵活性和便捷性。</p>
<h3 id="2-1-ValueAnimator的基本介绍"><a href="#2-1-ValueAnimator的基本介绍" class="headerlink" title="2.1 ValueAnimator的基本介绍"></a>2.1 ValueAnimator的基本介绍</h3><p>虎父无犬子，ObjectAnimator 既然能被广泛使用，其父类 ValueAnimator 作为一个强大的属性动画类当然要放在前面先说说了。ValueAnimator 提供了一系列改变属性的方式，在提供属性动画时，可以选择不同的数值增长方式控制属性值，线性增长、曲线增长等等，例如在缩放显示图像的过程中，如果选择线性增长，图片将匀速缩放，如果选择曲线增长，图片可以以加速或减速的方式缩放，并且还支持在动画执行过程中获取其值的分布和执行的过程监控等，<strong>但是！</strong> ValueAnimator 本身并不会改变控件的属性，也不会直接与动画本身进行联系和控制，常用的创建一个 ValueAnimator 对象的方法是：<code>ValueAnimator valueAnimator = ValueAnimator.ofXXX(xxx...);</code>，其中 <code>XXX</code> 表示不同类型的数据（int、float、args等），<code>xxx...</code> 表示变化范围，是一个可变长参数，例如给定 <code>ofInt(1, 0);</code>，表示从1变为0，给定 <code>ofInt(1, 0, 1);</code> 表示从1变为0再变为1。</p>
<p>ValueAnimator 实现动画的原理在于使用了：<strong>Interpolator（插值器）</strong> 和  <strong>TypeEvaluator（数值计算器）</strong>，通俗的说，Interpolator 可以根据给出的值来设定数值的变化方式，例如上文中提到的线性和曲线方式。其他 Interpolator 可以参考下面引用博文内的配图（特别简单明了，大赞！）。</p>
<p>在缩放执行的过程中，动画效果主要就是靠这两个工具来实现的。当我们给出需要缩放的目标大小是从原大小（缩放率为 1 ）放大到 2 倍（缩放率为 2），缩放时间为 1 秒，并选择线性增长的 Interpolator，那么 TypeEvaluator 就会生成一个时间长度为 1 秒，且缩放值从 1 到 2 的一系列数值，我们无法列举出每一个产生的数值，但是可以知道，当动画刚刚开始第 0 秒时，TypeEvaluator 计算的缩放率是 1；当动画结束的第 1 秒时，缩放率是 2；而在中间第 0.5 秒时，缩放率是 1.5 …… 也就是说，TypeEvaluator 会根据选定的 Interpolator 替我们计算好了某个时刻应该变化的具体值是多少，然后通过快速、连续地设定这个值来产生动画的效果。下面是改变一个 ImageView 的透明度的 Demo，布局很简单，一个 ImageView 一个 Button：</p>
<p><img data-src="./image_initial.png" alt="初始状态" title="@ASSET"></p>
<p>点击 Button 改变透明度：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化控件</span></span><br><span class="line">ImageView ivImage = findViewById(R.id.ivImage);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建ValueAnimator对象，并给定透明度变化为从完全显示到完全消失</span></span><br><span class="line">ValueAnimator valueAnimator = ValueAnimator.ofInt(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// 动画时间为1秒</span></span><br><span class="line">valueAnimator.setDuration(<span class="number">1000</span>);</span><br><span class="line"><span class="comment">// 设置插值方式为线性插值，即透明度匀速变化</span></span><br><span class="line">valueAnimator.setInterpolator(<span class="keyword">new</span> LinearInterpolator() );</span><br><span class="line"><span class="comment">// 开始动画</span></span><br><span class="line">valueAnimator.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听属性数值的改变并手动做事件处理</span></span><br><span class="line">valueAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取到改变的值</span></span><br><span class="line">        <span class="keyword">int</span> updateValue = animation.getAnimatedValue();</span><br><span class="line">        <span class="comment">// 改变TextView的透明度</span></span><br><span class="line">        ivImage.setAlpha(updateValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>看一下效果：</p>
<p><img data-src="./click_change_alpha.gif" alt="点击改变透明度" title="@ASSET"></p>
<p>当然这里还要提到一个工具： <strong>AnimatorUpdateListener</strong>，上文已经提到，ValueAnimator 会自动替我们计算好需要改变的数值，但是对于 Android 系统而言，它怎么知道数值到达几了呢？又该如何做对应的事件反馈呢？这就用到了 AnimatorUpdateListener 了，顾名思义这是一个 Listener，监听的就是 ValueAnimator 中 TypeEvaluator 产生的值，在 ValueAnimator 中，所有产生的值会根据给定的范围划分成比例的形式，例如由原大小缩放到2倍的动画中，缩放率为1.5时的比例就是0.5，AnimatorUpdateListener 可以监听这个数 TypeValue 的变化，我们可以自行给 TypeValue 变化的值做一些事件处理，例如放大到一半的时候顺便改变一下透明度，等等，然而从上面的步骤来看，其实它本身完全没有接触任何一个控件，而是产生一系列的数值，再由我们人为地给控件指定对应的值来实现动画效果。以上就是关于 ValueAnimator 的一些简单介绍了，其实逻辑非常简单，通俗地理解，就是把我们人为 <code>while(true)</code> 的步骤交给Android提供的自带工具来处理。</p>
<p>总结一下 ValueAnimator 实现动画的步骤：</p>
<ol>
<li>指定需要动画变换的值的范围</li>
<li>指定动画变换的时间</li>
<li>通过 ValueAnimator 对象指定动画的插值器变换方式 Interpolator</li>
<li>通过 ValueAnimator 对象的 TypeEvaluator 产生值</li>
<li>在监听器 AnimatorUpdateListener 中监听数值的变化并指定事件处理</li>
</ol>
<h2 id="2-2-ObjectAnimator的基本介绍"><a href="#2-2-ObjectAnimator的基本介绍" class="headerlink" title="2.2 ObjectAnimator的基本介绍"></a>2.2 ObjectAnimator的基本介绍</h2><p>上面介绍完了 ValueAnimator，接下来就要说说其子类 ObjectAnimator 了。既然是子类，当然 ValueAnimator 具有的一切特性 ObjectAnimator 也具有，并且通过重写父类的部分方法，从而提供了更高的易用性。举个例子，在 ValueAnimator 中，由于本身并不接触控件，因此对动画的实现始终需要我们手动去做一些处理，但是 ObjectAnimator 就大大提高了普遍情况下的简易性——它可以直接控制控件的常规属性，例如透明度、 缩放、旋转等等，对于不同的控件，都可以直接指定控件拥有的属性，用同样的方式创建一个 ObjectAnimator 对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator objectAnimator = ObjectAnimator.ofXXX(Object target, String propertyName, xxx...);</span><br></pre></td></tr></table></figure>

<ol>
<li>target: 需要应用变化的控件</li>
<li>propertyName: 需要改变的控件具体要改变的属性名。</li>
<li>xxx…: 需要改变的范围，是一个可变长参数，与上文中 ValueAnimator 的一样，就不重述了。</li>
</ol>
<p>这里主要讲一下 <strong>propertyName</strong> 的一个注意事项。在源码中，propertyName 最后会被 <code>setPropertyName(String propertyName);</code> 方法调用，对于这个方法源码的解释有这么一段：</p>
<p><img data-src="./code_of_setpropertyname.png" alt="setPropertyName 方法源码" title="@ASSET"></p>
<p>意思就是，根据传入的 String 属性名，通过把首字母强制大写，并在前面加上 “set”，然后反射寻找对应的设置方法。例如要改变 ImageView 的透明度，我们可以直接用 <code>tvText.setAlpha(alpha);</code> 来实现，但在 ObjectAnimator 的参数中，属性名要写 <code>&quot;alpha&quot;</code> 或 <code>&quot;Alpha&quot;</code>，如果我们写成 <code>&quot;setAlpha&quot;</code>，最后查找的方法就变成了 <code>setSetAlpha();</code>，这显然是不对的。</p>
<p>用 ObjectAnimator 同样实现一下设置 ImageView 的透明度1秒内逐渐消失的动画：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator objectAnimator = ObjectAnimator.ofInt(ivImage, <span class="string">&quot;alpha&quot;</span>, <span class="number">1</span>, <span class="number">0</span>).setDuration(<span class="number">1000</span>)；</span><br><span class="line">objectAnimator.start();</span><br></pre></td></tr></table></figure>

<p>可以很明显地看到，这个方法指定了控件—— <code>ivImage</code>，以及变化数值作用的属性的 setter 方法—— <code>setAlpha();</code>，只需要一步，就能实现与上文 ValueAnimator 一样的效果，是不是方便的多了？</p>
<blockquote>
<p>关于属性动画 ValueAnimator 与 ObjectAnimator 及其他更全面的介绍可以参考附录【2】</p>
</blockquote>
<hr>
<h2 id="3-ObjectAnimator配合Matrix"><a href="#3-ObjectAnimator配合Matrix" class="headerlink" title="3. ObjectAnimator配合Matrix"></a>3. ObjectAnimator配合Matrix</h2><p>了解完 ObjectAnimator 的基本内容后，思考一个问题：<strong>怎么用 ObjectAnimator 实现复杂的变换？</strong><br>在上文讨论的几个属性：透明度 Alpha、缩放 Scale、旋转 Rotate 等，几乎所有的 View 控件都具有直接设置的 setter 方法，可以很方便的直接套用 ObjectAnimator 来实现，但是如果是比较复杂的变化呢？比如，想要做一个由方形变为平行四边形的 <strong>“错切”过程动画</strong> 又或者是想要 <strong>以某个特定的点作为圆心进行缩放</strong>，这些在基本控件的内部并没有这么详细的 setter 方法，那要如何实现呢？</p>
<p>想要实现上述需求的方法，那就是利用 Matrix 啦！在前一篇博客中介绍了关于 Matrix 的一些基本内容，可以知道 Matrix 是控制控件变换的一个很强大的工具，并且控制的是控件内部的画面而不是控件本身，那么如果能用 ObjectAnimator 不直接控制控件，而是控制一个 Matrix，再由 Matrix 去控制控件，就能达到需求了。这么听起来，其实跟 ValueAnimator 非常像都是通过控制数值间接控制控件，因为毕竟 ValueAnimator 才是爹呀！（ObjectAnimator：？？？？？）</p>
<p>其实前面讲了过程，小伙伴肯定也已经想到了一个非常简单的实现方式：重写 View！在 View 中写一个接收 Matrix 的方法，通过这个方法把 Matrix 应用到图像中去实现变化效果。在 Demo 中，只是用了简单的 Scale 缩放，其实 ImageView 本身也提供了 <code>setScaleX();</code> 和 <code>setScaleY();</code> 方法，可以通过 PropertyValuesHolder 来一次改变两个属性（下文会讲到），但是我就想一次性同比例缩放，并且这个 Demo 仅仅是提供一种解决思路，例如在使用 Matrix 进行 Skew 错切变换时，重写 View 实现就是一个好方法了，读者可以举一反三多多尝试其他需要间接改变的属性。<br>还是这个 Demo，上代码！</p>
<p>首先因为我们需要自己的 View 中可以接收到 Matrix，所以先写一个接口，定义接收 Matrix 的方法，然后在自定义的View中实现这个接口并重写接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义 接收Matrix方法的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setScaleToMatrix</span><span class="params">(<span class="keyword">float</span> scaleValue)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以不用接口直接在自定义View中添加方法，但养成良好的编程习惯总没有坏处。接下来自定义 View 继承自 ImageView（根据需求选择继承）并实现接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是我自定义的 ScaleImageView，继承自 ImageView</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScaleImageView</span> <span class="keyword">extends</span> <span class="title">ImageView</span> <span class="keyword">implements</span> <span class="title">IView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重用的Matrix</span></span><br><span class="line">    Matrix matrix = <span class="keyword">new</span> Matrix();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 直接默认重写所有四个构造方法即可</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScaleImageView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScaleImageView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScaleImageView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScaleImageView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr, defStyleRes);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 实现并重写接口方法</span></span><br><span class="line">    <span class="comment">// 我将该方法命名为 setScaleMatrix</span></span><br><span class="line">    <span class="comment">// 则 ObjectAnimator 中属性名 String 为 “scaleMatrix”或“ScaleMatrix”</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScaleToMatrix</span><span class="params">(<span class="keyword">float</span> scaleValue)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 布局中为了初始时视觉美观设置 ScaleType 为 fit_center，需改成 matrix 否则 Matrix 变换不起作用</span></span><br><span class="line">        <span class="keyword">this</span>.setScaleType(ScaleType.MATRIX);</span><br><span class="line">        <span class="comment">// X、Y轴同比例缩放</span></span><br><span class="line">        matrix.setScale(scaleValue, scaleValue);</span><br><span class="line">        <span class="comment">// 调用 ImageView 自带的方法应用 Matrix</span></span><br><span class="line">        setImageMatrix(matrix);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MainActivity 中就简单了，在需要执行动画的地方创建 ObjectAnimator 再指定变化范围即可</span></span><br><span class="line"><span class="comment">// 初始化控件，略了</span></span><br><span class="line">ScaleImageView sivImage;</span><br><span class="line">......</span><br><span class="line"><span class="comment">// 设置按键监听，略了</span></span><br><span class="line">Button btButton；</span><br><span class="line">......</span><br><span class="line"><span class="comment">// 设置对应的属性和 setter 方法名，缩放范围：1 ~ 2，动画时间1秒</span></span><br><span class="line">ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">1f</span>, <span class="number">2f</span>).setDuration(<span class="number">1000</span>);</span><br><span class="line">objectAnimator.start();</span><br></pre></td></tr></table></figure>

<p>再看一下效果：</p>
<p><img data-src="./click_scale_up.gif" alt="点击放大" title="@ASSET"></p>
<p>可以看到，动画还是很好的，相比我们手动写成循环的方式，ObjectAnimator 流畅多了，这里给一个小提示，因为 Matrix 如果采用 set 的方式时都会先重置为单位矩阵，因此不需要每次传值缩放时都重新 <code>new Matrix();</code>，直接在自定义的 View 中声明并初始化一个 Matrix，可以减少对象的创建，节约内存。</p>
<blockquote>
<p>更多关于 ObjectAnimator 的详细资料可以参考附录【3】【4】</p>
</blockquote>
<hr>
<h2 id="4-ObjectAnimator多动画并行"><a href="#4-ObjectAnimator多动画并行" class="headerlink" title="4. ObjectAnimator多动画并行"></a>4. ObjectAnimator多动画并行</h2><p>现在我们的动画效果出来了，但是假如我又有一个需求，希望在放大的动画结束后再来个缩小的动画，怎么办呢？最直观的方法就是：在放大的动画下面在加一个缩小的动画不就行了吗？实践是检验真理的唯一标准，试一试就知道！在 MainActivity 调用动画的下面再加上缩小的动画：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 放大动画</span></span><br><span class="line">ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">1f</span>, <span class="number">2f</span>).setDuration(<span class="number">1000</span>);</span><br><span class="line">objectAnimator.start();</span><br><span class="line"><span class="comment">// 缩小动画</span></span><br><span class="line">objectAnimator = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleMatrix&quot;</span>, <span class="number">2f</span>, <span class="number">1f</span>).setDuration(<span class="number">1000</span>);</span><br><span class="line">objectAnimator.start();</span><br></pre></td></tr></table></figure>

<p>结果发现最后的效果是：</p>
<p><img data-src="./android-objectanimator-data/scale_up_and_down.gif" alt="放大接缩小动画" title="@ASSET"></p>
<p>视觉上来看，仿佛放大的动画并没有执行，直接跳过到了缩小的动画，但其实放大动画是执行了的，之所以会突然放大一下，并不是因为放大动画执行完的原因，而是我们设置的缩小动画的起始大小就是2f——两倍，所以动画会先从两倍大小开始缩小，造成这样的原因是因为：ObjectAnimator 在执行一个动画时，是非线程阻塞的 <em>（这也是比我们自己用<code>while()</code>写更好的原因之一）</em> ，在执行一个动画的时候，可以理解为 <code>objectAnimator.start();</code> 开始执行后，具体这个动画怎么变化，变多久，都交给后台处理 <em>（其实这个说法是不严谨的，因为要更新UI只有主线程才能做到，后面整理清楚了会专门再发一个从源码角度的解释）</em> ，然后主线程继续向下执行代码，而下一句代码就是缩小动画，于是放大动画刚刚开始，还没来得及展示，就已经开始执行缩小动画了，于是就变成了图中的效果。我们把第二个缩小的动画用改变透明度来替换一下，就直观多了！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 放大动画</span></span><br><span class="line">ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">1f</span>, <span class="number">2f</span>).setDuration(<span class="number">1000</span>);</span><br><span class="line">objectAnimator.start();</span><br><span class="line"><span class="comment">// 改变透明度</span></span><br><span class="line">objectAnimator = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;alpha&quot;</span>, <span class="number">1f</span>, <span class="number">0f</span>).setDuration(<span class="number">1000</span>);</span><br><span class="line">objectAnimator.start();</span><br></pre></td></tr></table></figure>

<p><img data-src="./scale_up_and_alpha.gif" alt="放大接改变透明度" title="@ASSET"></p>
<p>这个效果就很明显了，放大也是执行了的，改变透明度也是执行了的，因为每一次动画开始执行后就会继续向下执行，因此视觉上看起来很就是一起执行了。这也提供给了我们一个同时执行多个动画效果的思路：<strong>硬生生的把多个动画效果顺序提交执行</strong>。但是这也是非常非常不友好的实现方式，在每个动画效果比较简单、设备性能较好等情况下也许没有很严重的问题，但是如果动画复杂、处理量大，就会导致动画严重卡顿。于是这里就引出了 <strong>PropertyValuesHolder</strong> 这个工具，它和数据库中的 Transaction 事务管理非常像——要么不做、要么全做。</p>
<h3 id="4-1-PropertyValuesHolder属性值保存器"><a href="#4-1-PropertyValuesHolder属性值保存器" class="headerlink" title="4.1 PropertyValuesHolder属性值保存器"></a>4.1 PropertyValuesHolder属性值保存器</h3><p>PropertyValuesHolder 一次性记录多个要执行的动画，然后把自己传给 ObjectAnimator，来实现多个动画同时并行 <em>（事实上从底层上来看，CPU的处理在微观上依然单线程的，并且 PropertyValuesHolder 也有导致卡顿的风险）</em> ，下面是 PropertyValuesHolder 的使用样例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 PropertyValuesHolder 存入需要改变的属性和值</span></span><br><span class="line">PropertyValuesHolder pvhScale = PropertyValuesHolder.ofFloat(<span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">4.2f</span>, <span class="number">8.4f</span>);</span><br><span class="line">PropertyValuesHolder pvhAlpha = PropertyValuesHolder.ofFloat(<span class="string">&quot;alpha&quot;</span>, <span class="number">1f</span>, <span class="number">0f</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 ObjectAnimator 应用到控件中</span></span><br><span class="line">objectAnimator = ObjectAnimator.ofPropertyValuesHolder(sivImage, pvhScale, pvhAlpha);</span><br><span class="line">objectAnimator.setDuration(<span class="number">1000</span>);</span><br><span class="line">objectAnimator.start();</span><br></pre></td></tr></table></figure>

<p>从 PropertyValuesHolder（太长了，简称 PVH）的字面上就可以理解，PVH 是一个属性取值的保持器，也就是说，一个 PVH 对象就存入了一个你需要改变值的属性以及这个属性需要变化的取值，但是 PVH 本身是不接触控件的，从这方面来看，PVH 像极了 ValueAnimator，不同点在于 PVH 依然需要针对具体的属性。动画效果与上面的“放大接改变透明度”一样，就不再重复贴图了。</p>
<h3 id="4-2-AnimatorSet动画集合"><a href="#4-2-AnimatorSet动画集合" class="headerlink" title="4.2 AnimatorSet动画集合"></a>4.2 AnimatorSet动画集合</h3><p><code>AnimatorSet</code> 是一个动画集合，与之类似的还有一个叫 <code>AnimationSet</code>的东西，从功能性来说，AnimatorSet 更为强大，AnimationSet 实现的效果与 PropertyValuesHolder 相似，都是把动画组合在一起执行，而 AnimatorSet 强大的地方在于，不仅能让动画组合执行，还能通过指定顺序让多个动画依次执行，因此本文中仅对 AnimatorSet 进行简单的讲解，篇幅有限，此处就只列出基本的应用方法，细节原理和复杂应用考虑在日后补充。</p>
<p>先说说其中两个方法：</p>
<ul>
<li><code>AnimatorSet.playTogether(property1)</code></li>
<li><code>playSequentially(property2)</code></li>
</ul>
<p>这两个方法从字面上就很好理解了，<code>playTogether()</code> 是同时进行，<code>playSequentially()</code> 是逐一进行。这里 property1 和 property2 不是具体的参数，因为这两种方法都分别各有两种类型的参数。</p>
<p><code>playTogether()</code> 方法的参数可以是： <code>Collection&lt;Animator&gt;</code> 和 <code>Animator...</code>，先看后者很明显可以知道，毕竟这个方法是要实现“同时进行”，所以肯定支持多个动画一起作为可变长参数传入，第一个 Collection&lt;&gt; 就是集合，泛型是 Animator 类，也就是说 Collection 集合内的每一个元素都要是 Animator 的对象，这和可变长的 Animator… 是一样的。之所以是集合还是因为这个方法要同时执行所有动画，所以所有的动画在逻辑上是“一层”的，没有顺序、前后之分，在 Java 中就用集合来表示。</p>
<p><code>playSequentially()</code> 的方法参数可以是：<code>List&lt;Animator&gt;</code> 和 <code>Animator...</code>，与上面的大同小异，传进去的都是一个或多个 Animator 的对象，但是这里是 List 列表而不是集合，就是因为这个方法是逐一进行，是有执行的前后顺序之分的，在 Java 中就用 List 来表示。</p>
<p>从参数来看，无论是哪一种，目的都是传 Animator 对象过去，也就是我们要先定义一个个 Animator 的对象，然后制定出每一个 Animator 需要做的动画效果，再把这些（或一个）Animator 交给 AnimatorSet 替我们完成。在 Demo 中，我们可以这样运用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 放大动画</span></span><br><span class="line">ObjectAnimator zoomInAnim = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">1f</span>, <span class="number">2f</span>);</span><br><span class="line"><span class="comment">// 缩小动画</span></span><br><span class="line">ObjectAnimator zoomOutAnim = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">2f</span>, <span class="number">1f</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ObjectAnimator 继承自 ValueAnimator，而后者又继承自 Animator</span></span><br><span class="line">AnimatorSet animatorSet = <span class="keyword">new</span> AnimatorSet();</span><br><span class="line"><span class="comment">// 以下四种都是对的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同时进行方式一</span></span><br><span class="line">animatorSet.playTogether(zoomInAnim, zoomOutAnim);</span><br><span class="line"><span class="comment">// 同时进行方式二</span></span><br><span class="line">ArrayList&lt;Animator&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">arrayList.add(zoomInAnim);</span><br><span class="line">arrayList.add(zoomOutAnim);</span><br><span class="line"><span class="comment">// 关于 Collection 的详情可以参考网上，这里不细展开</span></span><br><span class="line">Collection&lt;Animator&gt; collection = arrayList;</span><br><span class="line">animatorSet.playTogether(collection);</span><br><span class="line">animatorSet.setDuration(<span class="number">1000</span>);</span><br><span class="line">animatorSet.start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 逐一进行方式一</span></span><br><span class="line">animatorSet.playSequentially(zoomInAnim, zoomOutAnim);</span><br><span class="line"><span class="comment">// 逐一进行方式二</span></span><br><span class="line">List&lt;Animator&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(zoomInAnim);</span><br><span class="line">list.add(zoomOutAnim);</span><br><span class="line">animatorSet.playSequentially(list);</span><br><span class="line">animatorSet.setDuration(<span class="number">1000</span>);</span><br><span class="line">animatorSet.start();</span><br></pre></td></tr></table></figure>

<p>除了上面两个方法外，还有以下这几个方法：</p>
<ul>
<li><code>play(Animator)</code></li>
<li><code>with(Animator)</code></li>
<li><code>before(Animator)</code></li>
<li><code>after(delayTime)</code></li>
<li><code>after(Animator)</code></li>
</ul>
<p>依然从字面上看就很好理解，<code>play()</code> 就是当前需要进行的动画，<code>with(Animator)</code> 就是同时执行的动画，<code>before(Animator)</code> 和 <code>after(Animator)</code> 就是需要在参数中的 Animator 前／后执行，而 <code>after(delayTime)</code> 方法是用来设置动画延迟执行的时间。具体的使用方式直接通过代码解释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Animator 集合</span></span><br><span class="line">AnimatorSet animatorSet = <span class="keyword">new</span> AnimatorSet();</span><br><span class="line"><span class="comment">// 定义四种动画：透明度减半，放大，缩小，旋转90°</span></span><br><span class="line">ObjectAnimator animAlpha, animZoomIn, animZoomOut, animRotation;</span><br><span class="line"></span><br><span class="line">animAlpha = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;alpha&quot;</span>, <span class="number">1f</span>, <span class="number">0.5f</span>);</span><br><span class="line">animZoomIn = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">1f</span>, <span class="number">2f</span>);</span><br><span class="line">animZoomOut = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">2f</span>, <span class="number">1f</span>);</span><br><span class="line">animRotation = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;rotation&quot;</span>, <span class="number">0f</span>, <span class="number">90f</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置动画的播放顺序</span></span><br><span class="line">animatorSet.play(animAlpha).with(animZoomIn);</span><br><span class="line">animatorSet.play(animZoomIn).before(animRotation);</span><br><span class="line">animatorSet.play(animZoomOut).after(animRotation);</span><br><span class="line">animatorSet.play(animRotation);</span><br><span class="line"></span><br><span class="line">animatorSet.setDuration(<span class="number">1000</span>);</span><br><span class="line">animatorSet.start();</span><br></pre></td></tr></table></figure>

<p>看一下我们预期的播放顺序，四个play操作从上到下的预期结果是：</p>
<ol>
<li>执行透明度减半，同时执行放大</li>
<li>执行放大，并且放大在旋转前执行</li>
<li>执行缩小，并且在旋转之后执行（也就是先旋转再缩小）</li>
<li>执行旋转</li>
</ol>
<p>整理一下播放顺序应该是：1（透明度减半，同时放大）→ 2（旋转）→ 3（缩小）。<br>可以看到，我们在 <code>play(Anim_1)</code> 动画后定义了 <code>with(anim_2)</code> ／ <code>before(anim_2)</code> ／ <code>after(anim_2)</code> 后，还需要在下面正式调用 <code>play(anim_2)</code> 才能完成播放，这是因为 <code>with</code>、<code>before</code>、<code>after</code> 只是制定了播放的顺序，并没有表示开始播放。并且，这三个方法是可以链式调用的，也即：<code>play().before().after().with()...</code> 但是我们应当避免这种写法，以避免出现 <code>play(anim1).before(anim2).after(anim2)</code> 这种矛盾的情况。看一下实际的动画结果：</p>
<p><img data-src="./animator_continually.gif" alt="连续动画" title="@ASSET"></p>
<p>确实和预期是相符的！AnimatorSet 也确实是一个对动画进行控制非常非常强大的工具。</p>
<blockquote>
<p>AnimatorSet的详解可以参考附录【5】<br>AnimatorSet以及AnimationSet的区别可以参考附录【6】</p>
</blockquote>
<h3 id="4-3-AnimatorListener动画监听"><a href="#4-3-AnimatorListener动画监听" class="headerlink" title="4.3 AnimatorListener动画监听"></a>4.3 AnimatorListener动画监听</h3><p>在做动画效果的时候，往往我们不会仅仅只是为了展示，而会接一些逻辑上的事情，比如 Splash 页面的动画在执行完后要进入主页、更改信息的动画执行完后要退回上一个界面、Tips 引导动画执行完后要打开对应的操作窗口等等，但是上文我们也提到过，不论是 ValueAnimator 也好，ObjectAnimator 也好，或者 Animation 视图动画也好，其动画的运行过程可以 <strong>理解为</strong> 是在后台执行的，而主线程依然会继续向下执行代码，因此如果我们只是简单地把需要操作的事务代码放在动画执行的后面，会导致事务和动画一起执行，那么我们到底要如何才能做到 <em>“动画执行完之后操作事务”</em> 呢？方法就是：利用 AnimatorListener 监听器。</p>
<p>同理，既然 AnimatorListener 是一个监听器，那它就需要被绑定到想要监听的动画上，动画监听有四个需要重写的方法：</p>
<ul>
<li><code>onAnimationStart(Animator animation)&#123;...&#125;</code>: 动画开始时要做的</li>
<li><code>onAnimationCancel(Animator animation)&#123;...&#125;</code>: 动画被取消时要做的</li>
<li><code>onAnimationRepeat(Animator animation)&#123;...&#125;</code>: 动画重复执行时要做的</li>
<li><code>onAnimationEnd(Animator animation)&#123;...&#125;</code>: 动画结束时要做的</li>
</ul>
<p>命名都很直观，第 1 个方法就是动画一开始要做的事，很简单就不多说了。这里再提一下第 2、3 个方法。<br><code>onAnimationCancel()</code> 是动画被取消时要做的，和 end 不同的是，cancel 中的事务是我们人为地调用 <code>animator.cancel();</code> 方法时才会触发，而 end 是动画自己执行完后就会执行的。</p>
<p>至于 <code>onAnimationRepeat();</code> 方法，我们在设置一个动画不论是属性动画也好还是视图动画也好，都可以设置动画重复的次数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objectAnimator.setRepeatCount(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<p><code>onAnimationRepeat();</code> 方法就会在动画每次重复执行时调用，并且第一次执行也算在内，也就是说我们设置的 repeatCount 是几，这个方法就会调用几次。</p>
<p>这么一看马上就知道了，要在动画结束时执行某些事务，直接重写 <code>onAnimationEnd()</code> 方法即可。如果我们想要 Demo 中的图片无限重复放大再缩小再放大再缩小……最直观的的解决方案当然是利用死循环来做，但是前面也说了，<code>while</code> 会导致主线程阻塞，对于比较简单的动画效果（例如本文的 Demo，或者旋转等等规律步骤比较少的）可以进行如下设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objectAnimater.setRepeatCount(ValueAnimator.INFINITE);  <span class="comment">// ValueAnimator.INFINITE是int型，值为-1</span></span><br></pre></td></tr></table></figure>

<p>这是 Android 官方给我们的方法，但是如果我们有一个非常非常复杂的动画（虽然基本上是没有这种需求的，Android 的动画大都能通过分解转换成简单动画）比如我非要把：放大，旋转、对称、缩小、错切、平移、旋转……作为单次动画流程然后再无限循环这个流程的话，显然我们很难把这么多操作写在一个方法里完成，这时就可以用一个脑洞大开的方式曲线救国啦—— <strong>AnimatorListener 的迭代</strong> ！</p>
<h4 id="4-3-1-AnimatorListener的迭代"><a href="#4-3-1-AnimatorListener的迭代" class="headerlink" title="4.3.1 AnimatorListener的迭代"></a>4.3.1 AnimatorListener的迭代</h4><p>仔细想一下 <code>AnimatorListener</code>，里面有 <code>onAnimationEnd()</code> 方法，再仔细想一下，只要我们设置的不是无限动画，那就都会在结束时调用监听。利用这个思路，我们可以定义一个动画执行步骤的变量，用来引导动画进行的顺序。在 Demo 中，仅用缩放作为示例，复杂的动画变换可以参考思路进行拓展。</p>
<p>先写出成员变量和动画监听部分，在按钮的点击事件中有一些处理放在下面讲。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 先让类实现 OnclickListener 和 AnimatorListener 接口，并在类中重写四个方法</span></span><br><span class="line"><span class="comment"> * 具有大量操作时，尽量避免使用下述匿名内部类的形式：</span></span><br><span class="line"><span class="comment"> * objectAnimator.addListener(new AnimatorListener() &#123;</span></span><br><span class="line"><span class="comment"> * ......</span></span><br><span class="line"><span class="comment"> * &#125;);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个动画步骤成员变量，用来指导动画执行的顺序</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> animStep = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ObjectAnimator objectAnimator;</span><br><span class="line"><span class="keyword">private</span> ScaleImageView sivImage;</span><br><span class="line"><span class="keyword">private</span> Button btButton;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 仅写出 onAnimationEnd() 部分</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animatior animation)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 判断一下非空的情况，避免在重复点击时出现空指针异常</span></span><br><span class="line">    <span class="keyword">if</span>(animation != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(animStep) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span> : &#123;</span><br><span class="line">                <span class="comment">// 在点击按钮时进行放大，因此在放大动画结束后应该先缩小</span></span><br><span class="line">                objectAnimator = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">2f</span>, <span class="number">1f</span>).setDuration(<span class="number">1000</span>);</span><br><span class="line">                <span class="comment">// 自增，指导第二个步骤</span></span><br><span class="line">                animStep++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span> : &#123;</span><br><span class="line">                <span class="comment">// 第二步为缩小，在 Demo 中只有两步，因此最后一步应把 animStep 重置</span></span><br><span class="line">                objectAnimator = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">1f</span>, <span class="number">2f</span>).setDuration(<span class="number">1000</span>);</span><br><span class="line">                <span class="comment">// 有多个步骤时，前面的步骤执行完 animStep 都自增，最后一步执行完后重置</span></span><br><span class="line">                animStep = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            defalut : <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        objectAnimator.start();</span><br><span class="line">        <span class="comment">// 再把自己重新注册进监听器内继续监听 onAnimationEnd() 方法</span></span><br><span class="line">        objectAnimator.addListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来就是点击按钮开始动画的部分了。在具体的应用中，并不一定非要用 Button 来触发动画，这里只是专门做一个提醒来指出在使用手动触发动画时一个容易出错的地方。在 Demo 中，按钮主要用来启动动画的第一次执行，那么我们常常只会想到要这么写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    objectAnimator = ObjectAnimator.ofFloat(sivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">1f</span>, <span class="number">2f</span>).setDuration(<span class="number">1000</span>);</span><br><span class="line">    objectAnimator.start();</span><br><span class="line">    objectAnimator.addListener(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行一下</p>
<p><img data-src="./init_click_event.gif" alt="初始点击事件" title="@ASSET"></p>
<p>乍一看确实没什么问题，确实达到预期的效果了，但是如果我们这时多次点击按钮就会“翻车”</p>
<p><img data-src="./multi_animator_issue.gif" alt="动画并行问题" title="@ASSET"></p>
<p>原因也很简单，因为我们每次点击时都会触发一次重新执行动画，并且也会加入动画监听，也就相当于每次点击都会增加一个动画效果的运行线，每个动画效果又自行监听运行过程，所以就会造成这样的混乱场面，如果是上文中的一系列复杂动画，翻车现场只会更加惨烈～解决的办法也很简单，就是每次点击都让动画步骤初始化从第一步开始，然后取消原先的所有动画，并且取消原先绑定的监听器，然后再重新绑定和设定动画的效果。改进的点击事件代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 依然要进行一个非空判断，否则第一次运行时会报空指针异常</span></span><br><span class="line">    <span class="comment">// 非空从逻辑上也表明了是“已经在执行动画的过程中再次点击”</span></span><br><span class="line">    <span class="keyword">if</span>(objectAnimator != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 取消当前的动画</span></span><br><span class="line">        objectAnimator.cancel();</span><br><span class="line">        <span class="comment">// 移除所有监听器，也可以单独仅移除 AnimatorListener</span></span><br><span class="line">        <span class="comment">// 仅移除某个监听器时，需要实例化具体的监听器并绑定动画</span></span><br><span class="line">        objectAnimator.removeAllListeners();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始化动画步骤</span></span><br><span class="line">    animStep = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 重新设置动画和监听</span></span><br><span class="line">    objectAnimator = ObjectAnimator.ofFloat(ivImage, <span class="string">&quot;scaleToMatrix&quot;</span>, <span class="number">1.05f</span>, <span class="number">2.1f</span>).setDuration(<span class="number">1000</span>);</span><br><span class="line">    objectAnimator.start();</span><br><span class="line">    objectAnimator.addListener(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>改进完后再看，也就不会出现翻车现场啦！</p>
<p><img data-src="./fixed_multi_animator.gif" alt="改进的并行动画" title="@ASSET"></p>
<p>这下这个 “<em><del>脑洞大开然鹅好像并没有什么卵用也不知道为什么要写这么多的需求</del></em>” 总算是解决了，代码而言是真的很简单也很少，但是思路和解决方案希望可以给同是初学的读者们一些灵感，用以运用在大型、复杂的项目中去。<br>本篇结合前一篇写的 <a href="/2018/09/06/Android/android-matrix-basic/">关于Matrix</a> 的文章，应该可以解决大部分情况下简单的动画场景了，但是这两篇博客的讲解可以说是非常皮毛的，甚至对于我自己的实际应用都远远不够，但还是那句话，本文主要目的是提供一种思维方式，再灵活运用进实际的项目中去。对于深入的 ObjectAnimator、 ValueAnimator、 Matrix内容，还是应该细读官方的文档和源码为好。</p>
<hr>
<h2 id="5-附录-参考指导"><a href="#5-附录-参考指导" class="headerlink" title="5. 附录[参考指导]"></a>5. 附录[参考指导]</h2><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/huolongluo/p/6792362.html" title="@LINK">【1】Android属性动画之ValueAnimator的介绍（作者：火龙裸先生）</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/harvic880925/article/details/50525521" title="@LINK">【2】自定义控件三部曲之动画篇(四)——ValueAnimator基本使用（作者：启舰）</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Leslie_LN/article/details/67639753" title="@LINK">【3】ObjectAnimator详解（作者：钉某人）</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Leslie_LN/article/details/67639753" title="@LINK">【4】属性动画之—ObjectAnimator基本使用（作者：Linleslie）</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/io_field/article/details/53101295" title="@LINK">【5】Android 动画之AnimatorSet（作者：行云间）</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ttml5945/article/details/80324128" title="@LINK">【6】动画之AnimatorSet和AnimationSet的区别（作者：tml5945）</a></li>
</ul>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">




<script>
    <!--动态浏览器标签-->
    var OriginTitle = document.title;
    var titleTime;
    var titleTime2;
    var titleTime3;
    var blankTitle = "\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000"
    blankTitle = blankTitle + blankTitle + blankTitle;
    document.addEventListener('visibilitychange', function () {
        if (document.hidden) {
            $('[rel="icon"]').attr('href', "/images/favicon-32x32-next.png");
            // 失去焦点时不切换标题
            // document.title = "Waiting...";
            document.title = OriginTitle;
            clearTimeout(titleTime);
            clearTimeout(titleTime2);
            clearTimeout(titleTime3);
        }
        else {
            document.title = "Welcome";
            titleTime = setTimeout(function () {
                document.title = "Back";
                titleTime2 = setTimeout(function () {
                    document.title = "Welcome Back !";
                    titleTime3 = setTimeout(function () {
                        document.title = OriginTitle;
                    }, 500);
                }, 300);
            }, 300);
        }
    });
</script>






    
    
    <style type="text/css">
        .postEndContainer {
            border-radius: 10px;
            margin-top: 50px;
            margin-bottom: 10px;
        }
        .toAbout {
            font-size: 18px;
            text-align: center;
            color: #EB6D39;
            cursor: pointer;
            border-bottom: none;
        }
        .toAbout:hover {
            background: #EB6D39;
            color: #FFFFFF;
            cursor: pointer;
            border-bottom: none;
        }

        .postEndText {
            animation: slideHorizontal 4.0s ease infinite;
        }
        
        @keyframes slideHorizontal {
            0% {
                transform: rotateX(0deg);
            }
            25% {
                transform: rotateX(360deg);
            }
            50% {
                transform: rotateX(720deg);
            }
            100% {
                transform: rotateX(720deg);
            }
        }
    </style>
    
        
        <div class="pagination postEndContainer toAbout" onClick="window.open('/about/','_self')">
            <div class="postEndText">全 文 结 束&ensp;&ensp;<i class="fab fa-leanpub"></i>&ensp;&ensp;点 击 留 言</div>
        </div>
    

    
    <img src="/images/reward.png" style="width: 300px; max-width: 100%;">


          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者: </strong>Luis
  </li>
  <li class="post-copyright-link">
      <strong>本文链接:</strong>
      <a href="https://www.liushulun.cn/post/android/android-objectanimator/" title="Android-ObjectAnimator">https://www.liushulun.cn/post/android/android-objectanimator/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明: </strong>所有文章均由 Luis 原创于 liushulun.cn，采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议，引用前请务必联系授权。
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"><i class="fa fa-tag"></i> Android</a>
              <a href="/tags/Matrix/" rel="tag"><i class="fa fa-tag"></i> Matrix</a>
              <a href="/tags/%E5%8A%A8%E7%94%BB/" rel="tag"><i class="fa fa-tag"></i> 动画</a>
              <a href="/tags/ObjectAnimator/" rel="tag"><i class="fa fa-tag"></i> ObjectAnimator</a>
              <a href="/tags/%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB/" rel="tag"><i class="fa fa-tag"></i> 属性动画</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/java/java-threadlocal/" rel="prev" title="Java-ThreadLocal">
                  <i class="fa fa-chevron-left"></i> Java-ThreadLocal
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/android/android-matrix/" rel="next" title="Android-Matrix入门">
                  Android-Matrix入门 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiuShulun</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Site Symbols:</span>
    <span title="Site Symbols">355k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Site Read Time &asymp;</span>
    <span title="Site Read Time">6:35</span>
  </span>
</div>


    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>





  <script>
    NProgress.configure({
      showSpinner: true
    });
    NProgress.start();
    document.addEventListener('readystatechange', () => {
      if (document.readyState === 'interactive') {
        NProgress.inc(0.8);
      }
      if (document.readyState === 'complete') {
        NProgress.done();
      }
    });
    document.addEventListener('pjax:send', () => {
      NProgress.start();
    });
    document.addEventListener('pjax:success', () => {
      NProgress.done();
    });
  </script>

  




  



<style type="text/css">
    .toBottom {
        color: #EEEEEE;
        border-bottom: none;
    }
    .toBottom:hover {
        color: #EB6D39;
        border-bottom: none;
    }
</style>
<div class="scrollToBottom back-to-top back-to-top-on" role="button" style="bottom: 30px;" onClick="window.open('#postBottom','_self')">
    <span class="fa fa-arrow-down"> Down</span>
</div>

<script>
    $(function() {
        $('.scrollToBottom').click(function(){
            
            $('html,body').animate({scrollTop:$('.bottom').offset().top}, 800);
        });
    })
</script>

<a id='postBottom'></a>
</body>
</html>
